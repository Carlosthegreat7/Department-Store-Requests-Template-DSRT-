{% extends "base.html" %}

{% block content %}
<style>
    .add-container { 
        max-width: 600px; 
        margin: 0 auto;
        padding-top: 30px; 
    }

    /* --- GLASSMOPHISM HEADER --- */
    .glass-header {
        height: 120px;
        background: #4361ee;
        border-radius: 28px;
        position: relative;
        overflow: hidden;
        display: flex;
        align-items: center;
        padding: 0 40px;
        color: white;
        margin-bottom: 30px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 15px 35px rgba(67, 97, 238, 0.2);
    }

    .glass-header::before {
        content: "";
        position: absolute;
        inset: 0;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        z-index: 1;
    }

    .header-text { z-index: 2; }
    .header-text h2 { font-weight: 800; letter-spacing: -1px; margin-bottom: 0; }

    /* --- BENTO FORM CONTROLS --- */
    .form-control-bento {
        border-radius: 50px !important;
        padding: 12px 25px !important;
        border: 1px solid #e9ecef !important;
        background-color: #f8f9fa !important;
        color: #2d3436 !important;
        transition: all 0.3s ease;
    }

    .form-control-bento:focus {
        background-color: #fff !important;
        border-color: var(--accent-purple) !important;
        box-shadow: 0 0 0 0.2rem rgba(86, 11, 173, 0.15) !important;
    }

    .btn-save {
        background-image: linear-gradient(to right, #667eea, #764ba2, #6B8DD6, #8E37D7);
        background-size: 300% 100%;
        color: #fff !important;
        border: none;
        border-radius: 50px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 1px;
        transition: all 0.4s ease-in-out;
        box-shadow: 0 4px 15px 0 rgba(116, 79, 168, 0.45);
    }

    .btn-save:hover {
        background-position: 100% 0;
        transform: translateY(-2px);
    }

    .modal-glass {
        backdrop-filter: blur(10px);
        background: rgba(255,255,255,0.1);
    }
    .modal-content-bento {
        border-radius: 30px;
        border: none;
        padding: 20px;
    }
</style>

<div class="container add-container">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <a href="{{ url_for('admin_management') }}" class="btn btn-sm btn-light rounded-pill px-3 shadow-sm text-muted">
            <i class="fas fa-arrow-left mr-1"></i> BACK TO DASHBOARD
        </a>
    </div>

    <div class="glass-header">
        <div class="header-text">
            <h2><i class="fas fa-plus-circle mr-3"></i>Add Vendor</h2>
        </div>
    </div>

    <div class="bento-tile shadow-lg">
        <form id="addVendorForm" action="{{ url_for('vendor.add_vendor') }}" method="POST" autocomplete="off">
            <div class="form-group mb-4">
                <label class="small font-weight-bold text-muted uppercase ml-2">Vendor Code</label>
                <input type="text" name="code" id="code" class="form-control form-control-bento" 
                       placeholder="6-digit code (e.g., 014353)" pattern="\d{6}" required>
            </div>

            <div class="form-group mb-4">
                <label class="small font-weight-bold text-muted uppercase ml-2">Vendor Name</label>
                <input type="text" name="name" id="name" class="form-control form-control-bento" 
                       placeholder="Full Company Name" required>
            </div>

            <hr class="my-4 opacity-25">

            <div class="d-flex justify-content-between">
                <a href="{{ url_for('admin_management') }}" class="btn btn-light rounded-pill px-4 font-weight-bold text-muted">CANCEL</a>
                <button type="button" class="btn btn-save px-5 py-2" onclick="validateAndShowModal()">
                    <i class="fas fa-check-circle mr-2"></i> Register Vendor
                </button>
            </div>
        </form>
    </div>
</div>

<div class="modal fade modal-glass" id="confirmAddModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content modal-content-bento bento-tile shadow-2xl">
            <div class="text-center p-4">
                <i class="fas fa-question-circle fa-4x text-primary mb-4"></i>
                <h3 class="font-weight-bold mb-3">Confirm Entry</h3>
                <p class="text-muted">Are you sure you want to add this vendor to the master records?</p>
                
                <div class="d-flex justify-content-center mt-4">
                    <button type="button" class="btn btn-light rounded-pill px-4 mr-3" data-dismiss="modal">Go Back</button>
                    <button type="button" class="btn btn-primary rounded-pill px-4" onclick="submitForm()">Confirm & Save</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // --- BROWSER NAVIGATION REFRESH FIX ---
    window.addEventListener('pageshow', function(event) {
        // Force a server-side refresh if navigating back/forward
        const navEntries = performance.getEntriesByType("navigation");
        if (event.persisted || (navEntries.length > 0 && navEntries[0].type === 'back_forward')) {
            window.location.reload(); 
        }
    });

    // Hard reset the form to clear browser-cached inputs
    window.onload = function() {
        document.getElementById('addVendorForm').reset();
    };

    function validateAndShowModal() {
        const codeInput = document.getElementById('code');
        const nameInput = document.getElementById('name');
        let isValid = true;

        [codeInput, nameInput].forEach(el => el.classList.remove('is-invalid'));

        if (!codeInput.checkValidity()) {
            codeInput.classList.add('is-invalid');
            isValid = false;
        }
        if (!nameInput.checkValidity()) {
            nameInput.classList.add('is-invalid');
            isValid = false;
        }

        if (isValid) {
            $('#confirmAddModal').modal('show');
        }
    }

    function submitForm() {
        document.getElementById('addVendorForm').submit();
    }
</script>
{% endblock %}